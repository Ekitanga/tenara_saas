{% extends 'base.html' %}

{% block title %}Dashboard - TENARA{% endblock %}

{% block page_title %}Dashboard{% endblock %}

{% block content %}
<!-- Subscription Alert -->
{% if subscription_status == 'none' %}
<div style="background: #fef3c7; border-left: 4px solid #f59e0b; padding: 1rem 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <strong style="color: #92400e;">‚ö†Ô∏è No Active Subscription</strong>
            <p style="color: #78350f; margin: 0.25rem 0 0 0;">Choose a plan to get started with TENARA.</p>
        </div>
        <a href="{% url 'subscriptions:plans' %}" style="background: #f59e0b; color: white; padding: 0.5rem 1rem; border-radius: 6px; text-decoration: none; font-weight: 600;">Choose a plan</a>
    </div>
</div>
{% elif is_trial %}
<div style="background: #dbeafe; border-left: 4px solid #2563eb; padding: 1rem 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <strong style="color: #1e40af;">üéâ Free Trial Active - {{ days_remaining }} days remaining</strong>
            <p style="color: #1e3a8a; margin: 0.25rem 0 0 0;">Upgrade to continue after trial ends.</p>
        </div>
        <a href="{% url 'subscriptions:plans' %}" style="background: #2563eb; color: white; padding: 0.5rem 1rem; border-radius: 6px; text-decoration: none; font-weight: 600;">Upgrade Now</a>
    </div>
</div>
{% endif %}

<!-- Welcome Section -->
<div style="margin-bottom: 2rem;">
    <h1 style="font-size: 2rem; font-weight: 800; margin-bottom: 0.5rem;">Welcome back, {{ user.get_full_name|default:user.username }}!</h1>
    <p style="color: #6b7280; font-size: 1.125rem;">Here's your rental portfolio overview.</p>
</div>

<!-- Stats Grid -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
    <!-- Total Properties -->
    <div style="background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border-left: 4px solid #2563eb;">
        <div style="color: #6b7280; font-size: 0.875rem; font-weight: 600; margin-bottom: 0.5rem;">TOTAL PROPERTIES</div>
        <div style="font-size: 2.5rem; font-weight: 800; color: #2563eb; margin-bottom: 0.25rem;">{{ stats.total_properties }}</div>
        <div style="font-size: 0.875rem; color: #6b7280;">{{ stats.total_units }} total units</div>
    </div>

    <!-- Occupancy Rate -->
    <div style="background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border-left: 4px solid #10b981;">
        <div style="color: #6b7280; font-size: 0.875rem; font-weight: 600; margin-bottom: 0.5rem;">OCCUPANCY RATE</div>
        <div style="font-size: 2.5rem; font-weight: 800; color: #10b981; margin-bottom: 0.25rem;">{{ stats.occupancy_rate|floatformat:1 }}%</div>
        <div style="font-size: 0.875rem; color: #6b7280;">{{ stats.occupied_units }}/{{ stats.total_units }} units occupied</div>
    </div>

    <!-- Rent Collected -->
    <div style="background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border-left: 4px solid #f59e0b;">
        <div style="color: #6b7280; font-size: 0.875rem; font-weight: 600; margin-bottom: 0.5rem;">RENT COLLECTED (MTD)</div>
        <div style="font-size: 2.5rem; font-weight: 800; color: #f59e0b; margin-bottom: 0.25rem;">KES {{ stats.rent_collected|floatformat:0 }}</div>
        <div style="font-size: 0.875rem; color: #6b7280;">This month</div>
    </div>

    <!-- Pending Amount -->
    <div style="background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border-left: 4px solid #ef4444;">
        <div style="color: #6b7280; font-size: 0.875rem; font-weight: 600; margin-bottom: 0.5rem;">TOTAL ARREARS</div>
        <div style="font-size: 2.5rem; font-weight: 800; color: #ef4444; margin-bottom: 0.25rem;">KES {{ stats.pending_amount|floatformat:0 }}</div>
        <div style="font-size: 0.875rem; color: #6b7280;">Outstanding balance</div>
    </div>

    <!-- Expenses -->
    <div style="background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border-left: 4px solid #8b5cf6;">
        <div style="color: #6b7280; font-size: 0.875rem; font-weight: 600; margin-bottom: 0.5rem;">EXPENSES (MTD)</div>
        <div style="font-size: 2.5rem; font-weight: 800; color: #8b5cf6; margin-bottom: 0.25rem;">KES {{ stats.total_expenses|floatformat:0 }}</div>
        <div style="font-size: 0.875rem; color: #6b7280;">This month's costs</div>
    </div>

    <!-- Net Profit -->
    <div style="background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border-left: 4px solid {% if stats.net_profit >= 0 %}#10b981{% else %}#ef4444{% endif %};">
        <div style="color: #6b7280; font-size: 0.875rem; font-weight: 600; margin-bottom: 0.5rem;">NET PROFIT (MTD)</div>
        <div style="font-size: 2.5rem; font-weight: 800; color: {% if stats.net_profit >= 0 %}#10b981{% else %}#ef4444{% endif %}; margin-bottom: 0.25rem;">KES {{ stats.net_profit|floatformat:0 }}</div>
        <div style="font-size: 0.875rem; color: #6b7280;">Revenue - Expenses</div>
    </div>
</div>

<!-- Quick Actions -->
<div style="background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 2rem;">
    <h2 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 1rem;">Quick Actions</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
        <a href="{% url 'property_create' %}" style="background: #f3f4f6; padding: 1rem; border-radius: 8px; text-decoration: none; color: #1f2937; text-align: center; font-weight: 600; transition: background 0.2s;">üè¢ Add Property</a>
        <a href="{% url 'unit_create' %}" style="background: #f3f4f6; padding: 1rem; border-radius: 8px; text-decoration: none; color: #1f2937; text-align: center; font-weight: 600; transition: background 0.2s;">üè† Add Unit</a>
        <a href="{% url 'tenants:create' %}" style="background: #f3f4f6; padding: 1rem; border-radius: 8px; text-decoration: none; color: #1f2937; text-align: center; font-weight: 600; transition: background 0.2s;">üë§ Add Tenant</a>
        <a href="{% url 'invoicing:create' %}" style="background: #f3f4f6; padding: 1rem; border-radius: 8px; text-decoration: none; color: #1f2937; text-align: center; font-weight: 600; transition: background 0.2s;">üìÑ Create Invoice</a>
        <a href="{% url 'payments:record_manual' %}" style="background: #f3f4f6; padding: 1rem; border-radius: 8px; text-decoration: none; color: #1f2937; text-align: center; font-weight: 600; transition: background 0.2s;">üí≥ Record Payment</a>
        <a href="{% url 'expenses:create' %}" style="background: #f3f4f6; padding: 1rem; border-radius: 8px; text-decoration: none; color: #1f2937; text-align: center; font-weight: 600; transition: background 0.2s;">üí∏ Log Expense</a>
        <a href="{% url 'reports:dashboard' %}" style="background: #f3f4f6; padding: 1rem; border-radius: 8px; text-decoration: none; color: #1f2937; text-align: center; font-weight: 600; transition: background 0.2s;">üìä View Reports</a>
    </div>
</div>

<!-- Recent Activity Grid -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 1.5rem;">
    <!-- Recent Payments -->
    <div style="background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h2 style="font-size: 1.25rem; font-weight: 700;">Recent Payments</h2>
            <a href="{% url 'payments:payment_list' %}" style="color: #2563eb; text-decoration: none; font-weight: 600; font-size: 0.875rem;">View All ‚Üí</a>
        </div>
        {% if recent_payments %}
        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="border-bottom: 2px solid #f3f4f6;">
                        <th style="text-align: left; padding: 0.75rem; font-size: 0.75rem; font-weight: 600; color: #6b7280;">DATE</th>
                        <th style="text-align: left; padding: 0.75rem; font-size: 0.75rem; font-weight: 600; color: #6b7280;">TENANT</th>
                        <th style="text-align: right; padding: 0.75rem; font-size: 0.75rem; font-weight: 600; color: #6b7280;">AMOUNT</th>
                    </tr>
                </thead>
                <tbody>
                    {% for payment in recent_payments %}
                    <tr style="border-bottom: 1px solid #f3f4f6;">
                        <td style="padding: 0.75rem; font-size: 0.875rem;">{{ payment.payment_date|date:"M d, Y" }}</td>
                        <td style="padding: 0.75rem; font-size: 0.875rem;">{{ payment.invoice.lease.tenant.user.get_full_name|default:payment.invoice.lease.tenant.user.username }}</td>
                        <td style="padding: 0.75rem; font-size: 0.875rem; text-align: right; font-weight: 600; color: #10b981;">KES {{ payment.amount|floatformat:0 }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p style="text-align: center; color: #6b7280; padding: 2rem;">üí∞ No payments received yet</p>
        {% endif %}
    </div>

    <!-- Recent Invoices -->
    <div style="background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h2 style="font-size: 1.25rem; font-weight: 700;">Recent Invoices</h2>
            <a href="{% url 'invoicing:list' %}" style="color: #2563eb; text-decoration: none; font-weight: 600; font-size: 0.875rem;">View All ‚Üí</a>
        </div>
        {% if recent_invoices %}
        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="border-bottom: 2px solid #f3f4f6;">
                        <th style="text-align: left; padding: 0.75rem; font-size: 0.75rem; font-weight: 600; color: #6b7280;">INVOICE #</th>
                        <th style="text-align: left; padding: 0.75rem; font-size: 0.75rem; font-weight: 600; color: #6b7280;">TENANT</th>
                        <th style="text-align: right; padding: 0.75rem; font-size: 0.75rem; font-weight: 600; color: #6b7280;">AMOUNT</th>
                        <th style="text-align: center; padding: 0.75rem; font-size: 0.75rem; font-weight: 600; color: #6b7280;">STATUS</th>
                    </tr>
                </thead>
                <tbody>
                    {% for invoice in recent_invoices %}
                    <tr style="border-bottom: 1px solid #f3f4f6;">
                        <td style="padding: 0.75rem; font-size: 0.875rem; font-weight: 600;"><a href="{% url 'invoicing:detail' invoice.pk %}" style="color: #2563eb; text-decoration: none;">{{ invoice.invoice_number }}</a></td>
                        <td style="padding: 0.75rem; font-size: 0.875rem;">{{ invoice.lease.tenant.user.get_full_name|default:invoice.lease.tenant.user.username }}</td>
                        <td style="padding: 0.75rem; font-size: 0.875rem; text-align: right; font-weight: 600;">KES {{ invoice.total_amount|floatformat:0 }}</td>
                        <td style="padding: 0.75rem; text-align: center;">
                            {% if invoice.status == 'paid' %}
                            <span style="background: #d1fae5; color: #065f46; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600;">Paid</span>
                            {% elif invoice.status == 'overdue' %}
                            <span style="background: #fee2e2; color: #991b1b; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600;">Overdue</span>
                            {% elif invoice.status == 'partial' %}
                            <span style="background: #fef3c7; color: #92400e; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600;">Partial</span>
                            {% else %}
                            <span style="background: #dbeafe; color: #1e40af; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600;">Pending</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p style="text-align: center; color: #6b7280; padding: 2rem;">üìÑ No invoices created yet</p>
        {% endif %}
    </div>
</div>
{% endblock %}
